name: Daily Ingest

on:
  workflow_dispatch:
  schedule:
    - cron: "15 13 * * *" # 05:15 Pacific (approx; GitHub cron is UTC)

concurrency:
  group: daily-ingest
  cancel-in-progress: false

jobs:
  ingest:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Ensure data (self-heal)
        env:
          ADMIN_TOKEN: ${{ secrets.ADMIN_TOKEN }}
        run: |
          set -euo pipefail
          curl -sS -X POST "https://congress-tracker-api.fly.dev/admin/ensure_data?token=${ADMIN_TOKEN}" | tee /dev/stderr
